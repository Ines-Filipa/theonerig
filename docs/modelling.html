---

title: Title
keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_modelling.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">theonerig.core</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">theonerig.processing</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">theonerig.utils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">theonerig.plotting</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sigmoid" class="doc_header"><code>sigmoid</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sigmoid</code>(<strong><code>x</code></strong>, <strong><code>sigma</code></strong>, <strong><code>amp</code></strong>, <strong><code>x0</code></strong>, <strong><code>y0</code></strong>)</p>
</blockquote>
<p>Sigmoid function
params:</p>

<pre><code>- x: 1D numpy array at which to evaluate the points
- sigma: steepness of the sigmoid
- amp: amplitude of the sigmoid
- x0: shift in x of the sigmoid
- y0: shift in y of the sigmoid</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gaussian" class="doc_header"><code>gaussian</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gaussian</code>(<strong><code>x</code></strong>, <strong><code>sigma</code></strong>, <strong><code>amp</code></strong>, <strong><code>x0</code></strong>, <strong><code>y0</code></strong>)</p>
</blockquote>
<p>Gaussian function
params:</p>

<pre><code>- x: 1D numpy array at which to evaluate the points
- sigma: width of the gaussian
- amp: amplitude of the gaussian
- x0: shift in x of the gaussian
- y0: shift in y of the gaussian</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gaussian_2D" class="doc_header"><code>gaussian_2D</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gaussian_2D</code>(<strong><code>xz</code></strong>, <strong><code>sigma_x</code></strong>, <strong><code>sigma_z</code></strong>, <strong><code>amp</code></strong>, <strong><code>theta</code></strong>, <strong><code>x0</code></strong>, <strong><code>z0</code></strong>, <strong><code>y0</code></strong>)</p>
</blockquote>
<p>Two dimensional Gaussian function
params:</p>

<pre><code>- xz: meshgrid of x and z coordinates at which to evaluate the points
- sigma_x: width of the gaussian
- sigma_z: height of the gaussian
- amp: amplitude of the gaussian
- theta: angle of the gaussian (in radian)
- x0: shift in x of the gaussian
- z0: shift in z of the gaussian
- y0: shift in y of the gaussian</code></pre>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sum_of_gaussian" class="doc_header"><code>sum_of_gaussian</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sum_of_gaussian</code>(<strong><code>t</code></strong>, <strong><code>sigma_1</code></strong>, <strong><code>amp_1</code></strong>, <strong><code>x0_1</code></strong>, <strong><code>sigma_2</code></strong>, <strong><code>amp_2</code></strong>, <strong><code>x0_2</code></strong>, <strong><code>y0</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sum_of_2D_gaussian" class="doc_header"><code>sum_of_2D_gaussian</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sum_of_2D_gaussian</code>(<strong><code>xz</code></strong>, <strong><code>sigma_x_1</code></strong>, <strong><code>sigma_z_1</code></strong>, <strong><code>amp_1</code></strong>, <strong><code>theta_1</code></strong>, <strong><code>x0_1</code></strong>, <strong><code>z0_1</code></strong>, <strong><code>sigma_x_2</code></strong>, <strong><code>sigma_z_2</code></strong>, <strong><code>amp_2</code></strong>, <strong><code>theta_2</code></strong>, <strong><code>x0_2</code></strong>, <strong><code>z0_2</code></strong>, <strong><code>y0</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">len_</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">len_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">_default_sigmoid_p</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">*</span><span class="n">_default_gaussian_p</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sum_of_gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">xz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gaussian_2D</span><span class="p">(</span><span class="n">xz</span><span class="p">,</span> <span class="o">*</span><span class="n">_default_2Dgaussian_p</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">len_</span><span class="p">,</span><span class="n">len_</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sum_of_2D_gaussian</span><span class="p">(</span><span class="n">xz</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">len_</span><span class="p">,</span><span class="n">len_</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_sigmoid" class="doc_header"><code>fit_sigmoid</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fit_sigmoid</code>(<strong><code>nonlin</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_spatial_sta" class="doc_header"><code>fit_spatial_sta</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fit_spatial_sta</code>(<strong><code>sta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#Load all the test data</span>
<span class="kn">from</span> <span class="nn">theonerig.testdata</span> <span class="k">import</span> <span class="o">*</span>
<span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_vivo_2p</span><span class="p">())</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Data_Pipe</span><span class="p">(</span><span class="n">reM</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;checkerboard&quot;</span><span class="p">,</span> <span class="s2">&quot;eye_tracking&quot;</span><span class="p">,</span> <span class="s2">&quot;S_matrix&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;stim_inten&quot;</span><span class="p">,</span> <span class="s2">&quot;eye_track&quot;</span><span class="p">,</span> <span class="s2">&quot;spike_counts&quot;</span><span class="p">])</span>
<span class="n">pipe</span> <span class="o">+=</span> <span class="s2">&quot;checkerboard&quot;</span>
<span class="n">result_sta</span> <span class="o">=</span> <span class="n">process_sta_batch</span><span class="p">(</span><span class="n">eyetrack_stim_inten</span><span class="p">(</span><span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;stim_inten&quot;</span><span class="p">],</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;eye_track&quot;</span><span class="p">]),</span> 
                               <span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;spike_counts&quot;</span><span class="p">],</span> <span class="n">Hw</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Returning stim_d, S_matrix, A_matrix, proj_TP, proj_DATA, eye_TP, eye_DATA, treadm_DATA, len_records, rec_TP, reM
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sta</span> <span class="o">=</span> <span class="n">result_sta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sta_to_fit</span> <span class="o">=</span> <span class="n">peak_sta_frame</span><span class="p">(</span><span class="n">sta</span><span class="p">)</span>
<span class="n">fit_2d</span> <span class="o">=</span> <span class="n">fit_spatial_sta</span><span class="p">(</span><span class="n">sta_to_fit</span><span class="p">)</span>
<span class="n">x</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">z</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">plot_2d_sta</span><span class="p">(</span><span class="n">sum_of_2D_gaussian</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">),</span> <span class="o">**</span><span class="n">fit_2d</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">plot_2d_sta</span><span class="p">(</span><span class="n">sta_to_fit</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_temporal_sta" class="doc_header"><code>fit_temporal_sta</code><a href="https://github.com/Tom-TBT/theonerig/tree/master/theonerig/modelling.py#L133" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fit_temporal_sta</code>(<strong><code>sta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#Fitting the temporal component of a STA</span>
<span class="n">sta_to_fit</span> <span class="o">=</span> <span class="n">sta</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">fit_2d</span><span class="p">[</span><span class="s1">&#39;z0_1&#39;</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">fit_2d</span><span class="p">[</span><span class="s1">&#39;x0_1&#39;</span><span class="p">])]</span>
<span class="n">fit_t</span> <span class="o">=</span> <span class="n">fit_temporal_sta</span><span class="p">(</span><span class="n">sta_to_fit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sta_to_fit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sum_of_gaussian</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sta_to_fit</span><span class="p">)),</span> <span class="o">**</span><span class="n">fit_t</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Data_Pipe</span><span class="p">(</span><span class="n">reM</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;checkerboard&quot;</span><span class="p">,</span> <span class="s2">&quot;eye_tracking&quot;</span><span class="p">,</span> <span class="s2">&quot;S_matrix&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;stim_inten&quot;</span><span class="p">,</span> <span class="s2">&quot;eye_track&quot;</span><span class="p">,</span> <span class="s2">&quot;spike_counts&quot;</span><span class="p">])</span>
<span class="n">pipe</span> <span class="o">+=</span> <span class="s2">&quot;checkerboard&quot;</span>
<span class="n">stim_inten_corrected</span> <span class="o">=</span> <span class="n">eyetrack_stim_inten</span><span class="p">(</span><span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;stim_inten&quot;</span><span class="p">],</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;eye_track&quot;</span><span class="p">])</span>
<span class="n">stim_ensembl</span> <span class="o">=</span> <span class="n">stimulus_ensemble</span><span class="p">(</span><span class="n">stim_inten_corrected</span><span class="p">)</span>
<span class="n">nonlin</span> <span class="o">=</span> <span class="n">process_nonlinearity</span><span class="p">(</span><span class="n">stim_ensembl</span><span class="p">,</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;spike_counts&quot;</span><span class="p">][</span><span class="mi">30</span><span class="p">:,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nonlin</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nonlin</span><span class="p">)),</span><span class="o">**</span><span class="n">fit_sigmoid</span><span class="p">(</span><span class="n">nonlin</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

